{% extends 'base.html' %}

{% block title %}Dashboard Analytics | Premiere Aesthetics{% endblock %}
{% block meta_description %}Vizualizare evenimente tracking: page views, click-uri pe elemente si conversii formular contact.{% endblock %}

{% block content %}
<section class="container py-5 mt-5">
  <div class="section-head">
    <p class="caps">Dashboard intern</p>
    <h1>Evenimente utilizatori si conversii</h1>
    <div class="mt-3 d-flex flex-wrap gap-2">
      <a class="btn btn-outline-light btn-sm" href="{% url 'core:home' %}">Inapoi la site</a>
      <a class="btn btn-outline-light btn-sm" href="{% url 'core:owner_logout' %}">Logout owner</a>
    </div>
  </div>

  <div class="row g-3 mb-4">
    <div class="col-md-4"><div class="glass-card p-3"><p class="caps">Total evenimente</p><h2 class="h3">{{ total_events }}</h2></div></div>
    <div class="col-md-4"><div class="glass-card p-3"><p class="caps">Page views</p><h2 class="h3">{{ total_page_views }}</h2></div></div>
    <div class="col-md-4"><div class="glass-card p-3"><p class="caps">Contact submits</p><h2 class="h3">{{ total_contact }}</h2></div></div>
  </div>

  <div class="row g-4">
    <div class="col-lg-8">
      <div class="glass-card p-3">
        <h3 class="h5">Evolutie evenimente</h3>
        <canvas id="eventsTimeline"></canvas>
      </div>
    </div>
    <div class="col-lg-4">
      <div class="glass-card p-3 h-100">
        <h3 class="h5">Top elemente accesate</h3>
        <ul class="list-unstyled mb-0">
          {% for item in top_elements %}
            <li class="d-flex justify-content-between border-bottom py-2"><span>{{ item.element }}</span><strong>{{ item.total }}</strong></li>
          {% empty %}
            <li>Nu exista date momentan.</li>
          {% endfor %}
        </ul>
        <p class="small mt-3 mb-0">Scroll depth mediu: {{ avg_scroll_depth }}%</p>
      </div>
    </div>
  </div>

  <div class="row g-4 mt-1">
    <div class="col-lg-12">
      <div class="glass-card p-3">
        <h3 class="h5">Top pagini vizitate</h3>
        <ul class="list-unstyled mb-0">
          {% for item in top_pages %}
            <li class="d-flex justify-content-between border-bottom py-2"><span>{{ item.page }}</span><strong>{{ item.total }}</strong></li>
          {% empty %}
            <li>Nu exista date de navigare momentan.</li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>
</section>

<script>
  const labels = {{ chart_labels|safe }};
  const values = {{ chart_values|safe }};
  const ctx = document.getElementById("eventsTimeline");
  if (ctx && labels.length) {
    new Chart(ctx, {
      type: "line",
      data: {
        labels: labels,
        datasets: [{
          label: "Evenimente",
          data: values,
          tension: 0.3,
          borderColor: "#f2b134",
          backgroundColor: "rgba(242, 177, 52, 0.3)",
          fill: true
        }]
      },
      options: {
        responsive: true,
        plugins: { legend: { display: true } }
      }
    });
  }
</script>
{% endblock %}
